FROM node:12.13-alpine

WORKDIR /usr/src/app

# RUN apk --no-cache add g++ gcc libgcc libstdc++ linux-headers make python
# RUN npm install --quiet node-gyp typescript -gs
# require to build bcrypt: https://github.com/kelektiv/node.bcrypt.js/wiki/Installation-Instructions#docker
RUN apk --no-cache add --virtual builds-deps build-base python

COPY package*.json ./

RUN npm install --quiet
RUN npm install --quiet node-gyp typescript -gs
RUN npm rebuild bcrypt --build-from-source

COPY . .

RUN npm run build

CMD ["node", "dist/main"]
